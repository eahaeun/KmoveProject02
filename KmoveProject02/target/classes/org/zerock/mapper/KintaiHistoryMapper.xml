<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.zerock.mapper.KintaiHistoryMapper">

    <insert id="insert">
        insert into KINTAI_HISTORY
        values (kintai_seq.nextval, #{shain_no}, #{kintai_km}, #{nyuryoku_ymd, jdbcType=TIMESTAMP}, #{kaishi_ymd, jdbcType=TIMESTAMP}, #{shuryo_ymd, jdbcType=TIMESTAMP}, #{kintai_hour}, #{kintai_pay})
    </insert>
    
    <select id="search" parameterType="java.lang.String" resultType="org.zerock.domain.KintaiHistoryVO">
    	SELECT * FROM KINTAI_HISTORY WHERE shain_no = #{shain_no}
	</select>
    
    <select id="read" resultType="org.zerock.domain.KintaiHistoryVO"> 
	select * from Kintai_history where shain_no = #{shain_no}
	</select>
	
	<select id="findBykintaiHistory" resultType="org.zerock.domain.KintaiHistoryVO">
	
	select * from Kintai_history where shain_no = #{shain_no} and TO_CHAR(nyuryoku_ymd, 'YYYY-MM') = #{kizoku_ym}
	
	</select>


	<select id="getDataByMonth" resultType="org.zerock.domain.KintaiHourVO">
	<![CDATA[
	    SELECT
	    	kh.shain_no,
	    	TO_CHAR(kh.kaishi_ymd, 'YYYY-MM') AS kaishi_month,
	    	TO_CHAR(kh.shuryo_ymd, 'YYYY-MM') AS shuryo_month,
	    	k.kintai_tani,
	    	SUM(kintai_hour) AS total_kintai_hour
		FROM
		    kintai_history kh
		    JOIN kintai k ON kh.kintai_km = k.kintai_km
		WHERE
		    TO_CHAR(kh.kaishi_ymd, 'YYYY-MM') = #{searchMonth, jdbcType=VARCHAR}
		    OR TO_CHAR(kh.shuryo_ymd, 'YYYY-MM') = #{searchMonth, jdbcType=VARCHAR}
		GROUP BY
		    kh.shain_no,
		    TO_CHAR(kh.kaishi_ymd, 'YYYY-MM'),
		    TO_CHAR(kh.shuryo_ymd, 'YYYY-MM'),
		    k.kintai_tani
	]]>
	</select>
	
	<select id="getDataByD" resultType="org.zerock.domain.KintaiHourVO">
	<![CDATA[
	    SELECT
		    kh.shain_no,
		    TO_CHAR(kh.kaishi_ymd, 'YYYY-MM') AS kaishi_month,
		    TO_CHAR(kh.shuryo_ymd, 'YYYY-MM') AS shuryo_month,
		    k.kintai_tani,
		    SUM(kintai_hour) AS total_kintai_hour
		FROM
		    kintai_history kh
		    JOIN kintai k ON kh.kintai_km = k.kintai_km
		WHERE
		    (TO_CHAR(kh.kaishi_ymd, 'YYYY-MM') = #{searchMonth, jdbcType=VARCHAR}
		    OR TO_CHAR(kh.shuryo_ymd, 'YYYY-MM') = #{searchMonth, jdbcType=VARCHAR})
		    AND k.kintai_tani = 'D'
		GROUP BY
		    kh.shain_no,
		    TO_CHAR(kh.kaishi_ymd, 'YYYY-MM'),
		    TO_CHAR(kh.shuryo_ymd, 'YYYY-MM'),
		    k.kintai_tani
	]]>
	</select>
</mapper>